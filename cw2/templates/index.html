{% extends "base.html" %}
{% from "includes/icons.html" import icon_eye, icon_like, icon_comment %}

{% block title %}Home - Badminton Forum{% endblock %}

{% block content %}
<div class="container">
    <div class="layout">
        <aside class="sidebar" role="complementary">
            <section class="sidebar-section">
                <h2>Categories</h2>
                <nav aria-label="Category navigation">
                    <a href="{{ url_for('main.index') }}" 
                       class="category-link {% if not category %}active{% endif %}">All</a>
                    <a href="{{ url_for('main.index', category='Technique') }}" 
                       class="category-link {% if category == 'Technique' %}active{% endif %}">Technique</a>
                    <a href="{{ url_for('main.index', category='Equipment') }}" 
                       class="category-link {% if category == 'Equipment' %}active{% endif %}">Equipment</a>
                    <a href="{{ url_for('main.index', category='Tournament') }}" 
                       class="category-link {% if category == 'Tournament' %}active{% endif %}">Tournament</a>
                    <a href="{{ url_for('main.index', category='Training') }}" 
                       class="category-link {% if category == 'Training' %}active{% endif %}">Training</a>
                    <a href="{{ url_for('main.index', category='Other') }}" 
                       class="category-link {% if category == 'Other' %}active{% endif %}">Other</a>
                </nav>
            </section>
            
            <section class="sidebar-section">
                <h2>Popular Tags</h2>
                <div class="tag-cloud" role="list" aria-label="Popular tags">
                    {% if hot_tags %}
                        {% for tag in hot_tags %}
                            <a href="{{ url_for('main.tag_detail', tag_name=tag.name) }}" 
                               class="tag tag-{{ 'hot' if tag.usage_count > 20 else 'normal' }}"
                               style="font-size: {{ 12 + (tag.usage_count / 10) }}px;">
                                {{ tag.name }}
                            </a>
                        {% endfor %}
                    {% else %}
                        <p class="empty-tags">No tags yet</p>
                    {% endif %}
                </div>
            </section>
            
            {% if recommended_posts %}
            <section class="sidebar-section">
                <h2>Recommended</h2>
                <ul class="recommended-list">
                    {% for post in recommended_posts %}
                        <li>
                            <a href="{{ url_for('main.post_detail', post_id=post.id) }}">
                                {{ post.title }}
                            </a>
                        </li>
                    {% endfor %}
                </ul>
            </section>
            {% endif %}
        </aside>
        
        <div class="main-area">
            <div class="posts-header">
                <h1>Posts</h1>
                <div class="sort-options">
                    <a href="{{ url_for('main.index', sort='latest', category=category, tag=tag_name) }}" 
                       class="sort-link {% if sort == 'latest' %}active{% endif %}">Latest</a>
                    <a href="{{ url_for('main.index', sort='hot', category=category, tag=tag_name) }}" 
                       class="sort-link {% if sort == 'hot' %}active{% endif %}">Hot</a>
                    <a href="{{ url_for('main.index', sort='comments', category=category, tag=tag_name) }}" 
                       class="sort-link {% if sort == 'comments' %}active{% endif %}">Most Comments</a>
                    <a href="{{ url_for('main.index', sort='likes', category=category, tag=tag_name) }}" 
                       class="sort-link {% if sort == 'likes' %}active{% endif %}">Most Likes</a>
                </div>
            </div>
            
            <div class="posts-list" role="list">
                {% for post in posts %}
                    <article class="post-card" role="listitem">
                        <div class="post-header">
                            <h2>
                                <a href="{{ url_for('main.post_detail', post_id=post.id) }}">
                                    {{ post.title }}
                                </a>
                            </h2>
                            <div class="post-meta">
                                <a href="{{ url_for('main.user_profile', username=post.author.username) }}" 
                                   class="author-link">{{ post.author.username }}</a>
                                <span class="post-time">{{ time_ago(post.created_at) }}</span>
                                <span class="post-category">{{ get_category_display(post.category) }}</span>
                            </div>
                        </div>
                        
                        <div class="post-preview">
                            {{ get_text_preview(post.content, 100) }}
                        </div>
                        
                        <div class="post-footer">
                            <div class="post-tags">
                                {% for tag in post.tags %}
                                    <a href="{{ url_for('main.tag_detail', tag_name=tag.name) }}" 
                                       class="tag">{{ tag.name }}</a>
                                {% endfor %}
                            </div>
                            <div class="post-stats">
                                <span>{{ icon_eye() }} {{ post.view_count }}</span>
                                <span>{{ icon_like() }} {{ post.like_count }}</span>
                                <span>{{ icon_comment() }} {{ post.comment_count }}</span>
                            </div>
                        </div>
                    </article>
                {% else %}
                    <div class="empty-state">
                        <p>No posts yet</p>
                    </div>
                {% endfor %}
            </div>
            
            {% if pagination and pagination.pages > 1 %}
                <nav class="pagination" aria-label="Pagination">
                    {% if pagination.has_prev %}
                        <a href="{{ url_for('main.index', page=pagination.prev_num, sort=sort, category=category, tag=tag_name) }}" 
                           class="pagination-link">Previous</a>
                    {% endif %}
                    
                    {% for page_num in range(1, pagination.pages + 1) %}
                        {% if page_num == pagination.page %}
                            <span class="pagination-current">{{ page_num }}</span>
                        {% else %}
                            <a href="{{ url_for('main.index', page=page_num, sort=sort, category=category, tag=tag_name) }}" 
                               class="pagination-link">{{ page_num }}</a>
                        {% endif %}
                    {% endfor %}
                    
                    {% if pagination.has_next %}
                        <a href="{{ url_for('main.index', page=pagination.next_num, sort=sort, category=category, tag=tag_name) }}" 
                           class="pagination-link">Next</a>
                    {% endif %}
                </nav>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}



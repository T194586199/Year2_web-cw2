{% extends "base.html" %}
{% from "includes/icons.html" import icon_eye, icon_like, icon_comment %}

{% block title %}Search{% if query %}: {{ query }}{% endif %} - Badminton Forum{% endblock %}

{% block content %}
<div class="container">
    <div class="search-header">
        <h1>Search Results</h1>
        {% if query %}
            <p>Search keyword: <strong>{{ query }}</strong></p>
        {% endif %}
    </div>
    
    {% if posts %}
        <div class="posts-list">
            {% for post in posts %}
                <article class="post-card">
                    <h2>
                        <a href="{{ url_for('main.post_detail', post_id=post.id) }}">
                            {{ post.title }}
                        </a>
                    </h2>
                    <div class="post-meta">
                        <a href="{{ url_for('main.user_profile', username=post.author.username) }}" 
                           class="author-link">{{ post.author.username }}</a>
                        <span class="post-time">{{ time_ago(post.created_at) }}</span>
                        <span class="post-category">{{ get_category_display(post.category) }}</span>
                    </div>
                    <div class="post-preview">
                        {{ get_text_preview(post.content, 200) }}
                    </div>
                    <div class="post-stats">
                        <span>{{ icon_eye() }} {{ post.view_count }}</span>
                        <span>{{ icon_like() }} {{ post.like_count }}</span>
                        <span>{{ icon_comment() }} {{ post.comment_count }}</span>
                    </div>
                </article>
            {% endfor %}
        </div>
        
        {% if pagination and pagination.pages > 1 %}
            <nav class="pagination">
                {% if pagination.has_prev %}
                    <a href="{{ url_for('main.search', q=query, page=pagination.prev_num) }}" 
                       class="pagination-link">Previous</a>
                {% endif %}
                
                {% for page_num in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
                    {% if page_num %}
                        {% if page_num == pagination.page %}
                            <span class="pagination-current">{{ page_num }}</span>
                        {% else %}
                            <a href="{{ url_for('main.search', q=query, page=page_num) }}" 
                               class="pagination-link">{{ page_num }}</a>
                        {% endif %}
                    {% else %}
                        <span class="pagination-ellipsis">â€¦</span>
                    {% endif %}
                {% endfor %}
                
                {% if pagination.has_next %}
                    <a href="{{ url_for('main.search', q=query, page=pagination.next_num) }}" 
                       class="pagination-link">Next</a>
                {% endif %}
            </nav>
        {% endif %}
    {% else %}
        <div class="empty-state">
            <p>No posts found</p>
        </div>
    {% endif %}
</div>
{% endblock %}


